var ContentFilter=function(){var d=[],n={id:"owner",name:"owner",filterStanza:function(a){return"author"in a&&a.author==Conversations.getCurrentConversation().author},enabled:!0},p={id:"myPrivate",name:"My private content",filterStanza:function(a){return"author"in a&&a.author==UserSettings.getUsername()&&"privacy"in a&&"PRIVATE"==a.privacy},enabled:!0},q={id:"myPublic",name:"My public content",filterStanza:function(a){return"author"in a&&a.author==UserSettings.getUsername()&&"privacy"in a&&"PUBLIC"==
a.privacy},enabled:!0},r={id:"peer",name:"My peers' content",filterStanza:function(a){return"author"in a&&a.author!=Conversations.getCurrentConversation().author&&a.author!=UserSettings.getUsername()},enabled:!0},t=function(a){return{id:a.id,name:a.name,filterStanza:function(b){var c="members"in a?a.members:[];return"author"in b&&_.includes(c,b.author)},type:"group",enabled:!0}},u=function(a,b){return b&&a.audiences.length?!0:d.length&&a.audiences&&a.audiences.length&&!_.some(a.audiences,function(a){return _.includes(d,
a.name)||_.includes(d,a)})},l=function(a){var b=Participants.getParticipants()[a.author],c=!UserSettings.getIsInteractive();return b&&!b.following||u(a,c)?!1:_.some(e,function(b){return b.enabled&&b.filterStanza(a)})},g=function(a){return function(b,c,d,e,g,v,f,h){l(b)&&a(b,c,d,e,g,v,f,h)}},e=[],f={},m={};$(function(){var a=drawText,b=drawImage,c=drawMultiwordText;drawInk=g(drawInk);drawText=g(a);drawImage=g(b);drawMultiwordText=g(c);$("#menuContentFilter").on("click",function(){showBackstage("contentFilter");
updateActiveMenu(this)});f=$("#contentFilterListing");m=f.find(".contentFilterItem").clone();f.empty()});var w=function(a){var b=m.clone(),c=b.find(".contentFilterCheckbox"),d=b.find(".contentFilterCheckboxLabel"),e=b.find(".contentFilterCheckboxLabelText"),g=sprintf("contentFilter_%s",a.id);if(Conversations.getCurrentSlide()){var f=_.find(Conversations.getCurrentGroups(),function(b){return b.id==a.id});f?e.text(sprintf("Group %s: %s",f.title,_.join(f.members,","))):e.text(a.name)}else e.text(a.name);
d.attr("for",g);c.prop("checked",a.enabled);c.attr("id",g);c.on("change",function(){a.enabled=c.is(":checked");k();blit()});return b},k=function(){f.html(_.map(e,w))},h=function(){var a=Conversations.getCurrentSlide(),b=[p,q];Conversations.isAuthor()||(b=b.concat(n));Conversations.getCurrentGroups().length||(b=b.concat(r));e=b.concat(a?_.map(Conversations.isAuthor()?Conversations.getCurrentGroups():Conversations.getCurrentGroup(),t):[]);k();blit()};Progress.currentSlideJidReceived.ContentFilter=function(){d=
[];h()};Progress.onConversationJoin.ContentFilter=function(){d=[];h()};Progress.afterJoiningSlide.ContentFilter=function(){d=[];h()};Progress.conversationDetailsReceived.ContentFilter=h;return{getFilters:function(){return e},setFilter:function(a,b){_.each(e,function(c){c.id==a&&(c.enabled=b)});k();blit()},getAudiences:function(){return d},setAudience:function(a){d=[a]},clearAudiences:function(){d=[]},exposes:l}}();
