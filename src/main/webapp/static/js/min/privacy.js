var Privacy=function(){var b="PUBLIC",d=function(){$.each(g,function(a,c){c==b?$("#"+a).addClass("activePrivacy active"):$("#"+a).removeClass("activePrivacy active")});var a=Conversations.getIsBanned();$("#publicize").toggleClass("disabled",a);$("#currentlyBanned").text(1==a?"(banned because of inappropriate content)":"");$("#currentPrivacyStatus").text("PUBLIC"==b?"publicly":"privately")},e=function(a){return h(a)?(b=a,Progress.call("onPrivacyChanged"),!0):!1},g={privateMode:"PRIVATE",publicMode:"PUBLIC"},
k={publicize:"PUBLIC",privatize:"PRIVATE"},h=function(a){return"PUBLIC"!=a||"PUBLIC"==a&&Conversations.shouldPublishInConversation()?!0:!1},f=function(){$("#currentConversationState").text(Conversations.getConversationModeDescriptor());$("#currentConversationTitle").text(Conversations.getCurrentConversation().title);Conversations.shouldPublishInConversation()?$("#publicMode").removeClass("disabledButton"):($("#publicMode").addClass("disabledButton"),e("PRIVATE"));d()},l=function(a){a&&$.each(k,function(m,
c){var b=$("#"+m);b.addClass("disabledButton");"images"in a&&_.some(a.images,function(a){return a.privacy!=c})&&b.removeClass("disabledButton");"inks"in a&&_.some(a.inks,function(a){return a.privacy!=c})&&b.removeClass("disabledButton");"multiWordTexts"in a&&_.some(a.multiWordTexts,function(a){return a.privacy!=c})&&b.removeClass("disabledButton");"texts"in a&&_.some(a.texts,function(a){return a.privacy!=c})&&b.removeClass("disabledButton")})};$(function(){$.each(g,function(a,b){$("#"+a).click(function(){e(b)})});
$.each(k,function(a,b){$("#"+a).click(function(){if(h(b)&&Modes.currentMode==Modes.select){var a=batchTransform();a.newPrivacy=b;a.imageIds=_.map(Modes.select.selected.images,"identity");a.textIds=_.map(Modes.select.selected.texts,"identity");a.multiWordTextIds=_.map(Modes.select.selected.multiWordTexts,"identity");a.inkIds=_.map(Modes.select.selected.inks,"identity");(0<_.size(a.imageIds)||0<_.size(a.textIds)||0<_.size(a.inkIds)||0<_.size(a.multiWordTextIds))&&sendStanza(a)}}).addClass("disabledButton")});
f();d();l({})});Progress.conversationDetailsReceived.privacy=f;Progress.onPrivacyChanged.privacy=d;Progress.onConversationJoin.privacy=function(){f();e("PUBLIC");d()};Progress.onSelectionChanged.privacy=l;return{getCurrentPrivacy:function(){return b},setPrivacy:function(a){e(a);return b}}}();
