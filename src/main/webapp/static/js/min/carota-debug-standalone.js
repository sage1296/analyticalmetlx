(function(e){var k,g,c,l,f,a={".js":[],".json":[],".css":[],".html":[]},d="function"===typeof require?require:null;l=function(b){b=Error("Could not find module '"+b+"'");b.code="MODULE_NOT_FOUND";return b};f=function(b,d,h){var v,f;if("function"===typeof b[d+h])return d+h;for(v=0;f=a[h][v];++v)if("function"===typeof b[d+f])return d+f;return null};k=function(b,a,h,d,c,e){var m,q;h=h.split(/[\\/]/);m=h.pop();if("."===m||".."===m)h.push(m),m="";for(;null!=(q=h.shift());)if(q&&"."!==q&&(".."===q?(b=a.pop(),
e=e.slice(0,e.lastIndexOf("/"))):(a.push(b),b=b[q],e+="/"+q),!b))throw l(d);m&&"function"!==typeof b[m]&&((h=f(b,m,".js"))||(h=f(b,m,".json")),h||(h=f(b,m,".css")),h||(h=f(b,m,".html")),h?m=h:2!==c&&"object"===typeof b[m]&&(a.push(b),b=b[m],e+="/"+m,m=""));if(!m)return 1!==c&&b[":mainpath:"]?k(b,a,b[":mainpath:"],d,1,e):k(b,a,"index",d,2,e);c=b[m];if(!c)throw l(d);if(c.hasOwnProperty("module"))return c.module.exports;d={};c.module=m={exports:d,id:e+"/"+m};c.call(d,d,m,g(b,a,e));return m.exports};
c=function(b,a,h,f){var c,g=h;c=h.charAt(0);var m=0;if("/"===c){g=g.slice(1);b=e["/"];if(!b){if(d)return d(h);throw l(h);}f="/";a=[]}else if("."!==c){c=g.split("/",1)[0];b=e[c];if(!b){if(d)return d(h);throw l(h);}f=c;a=[];g=g.slice(c.length+1);g||((g=b[":mainpath:"])?m=1:(g="index",m=2))}return k(b,a,g,h,m,f)};g=function(b,a,d){return function(f){return c(b,[].concat(a),f,d)}};return g(e,[],"")})({carota:{src:{"carota.js":function(e,k,g){e=g("./node");var c=g("./editor"),l=g("./doc"),f=g("./dom"),
a=g("./runs"),d=g("./html"),b=g("./frame"),p=g("./text");g=g("./rect");g={node:e,editor:c,document:l,dom:f,runs:a,html:d,frame:b,text:p,rect:g};k.exports=g;if("undefined"!==typeof window&&window.document){if(window.carota)throw Error("Something else is called carota!");window.carota=g}},"characters.js":function(e,k,g){function c(b,a,h){return Object.create(d,{_runs:{value:b},_run:{value:a},_offset:{value:h},"char":{value:a>=b.length?null:f.getTextChar(b[a].text,h)}})}function l(b,a){for(;a<b.length;a++)if(0!=
f.getTextLength(b[a].text))return c(b,a,0);return c(b,b.length,0)}var f=g("./runs"),a=function(b,a){if(b._runs!==a._runs)throw Error("Characters for different documents");},d={equals:function(b){a(this,b);return this._run===b._run&&this._offset===b._offset},cut:function(b){a(this,b);var d=this;return function(a){for(var c=d._run;c<=b._run;c++){var e=d._runs[c];if(e){var l=c===d._run?d._offset:0,g=c===b._run?b._offset:f.getTextLength(e.text);l<g&&f.getSubText(function(b){var d=Object.create(e);d.text=
b;a(d)},e.text,l,g-l)}}}}};k.exports=function(b){return function(a){for(var d=l(b,0);!a(d)&&null!==d["char"];)d=d._offset+1<f.getTextLength(b[d._run].text)?c(b,d._run,d._offset+1):l(b,d._run+1)}}},"codes.js":function(e,k,g){var c=g("./text"),l=g("./frame"),f=g("./node"),a=g("./rect"),d=g("./util"),b=f.derive({parent:function(){return this._parent},draw:function(a){this.inline.draw(a,this.left,this.baseline,this.measured.width,this.measured.ascent,this.measured.descent,this.formatting)},position:function(a,
b,d){this.left=a;this.baseline=b;d&&(this._bounds=d)},bounds:function(){return this._bounds||a(this.left,this.baseline-this.measured.ascent,this.measured.width,this.measured.ascent+this.measured.descent)},byCoordinate:function(a,b){return a<=this.bounds().center().x?this:this.next()}}),p={number:function(a,b){var d=b+1+".";return{measure:function(a){return c.measure(d,a)},draw:function(a,b,h,f,t,r,y){c.draw(a,d,y,b,h,f,t,r)}}}};p.listNext=p.listEnd=function(a){return d.derive(a,{eof:!0,measure:function(a){return{width:18,
ascent:0,descent:0}},draw:function(a,b,d){}})};p.listStart=function(h,c,p){return d.derive(h,{block:function(d,c,v,e,t,r){var y=f.generic("list",t,d,c),x,g,z,u=function(a,r){x=f.generic("item",y);var t=p(a.marker||{$:"number"},y.children().length);if(!t.draw||!t.measure)throw Error();z=Object.create(b,{inline:{value:t},_parent:{value:x},ordinal:{value:e},length:{value:1},formatting:{value:r},measured:{value:t.measure(r)}});z.block=!0;g=l(d+50,c,v-50,e+1,x,function(a){return"listEnd"===a.$},z.measured.ascent)};
u(h,r);return function(b){g?g(function(b){e=b.ordinal+b.length;var r=b.bounds(),t=b.first(),h=d+50-10-z.measured.width,f=a(d,c,50,r.h);"baseline"in t?z.position(h,t.baseline,f):z.position(h,c+z.measured.ascent,f);c=r.t+r.h;x.children().push(z);x.children().push(b);x.finalize();y.children().push(x);x=g=z=null},b):e++;if(!g){var r=b.code();if(r){if("listEnd"==r.$)return y.finalize(),y;"listNext"==r.$&&u(r,b.codeFormatting())}}}}})};k.exports=e=function(a,b,d){var c=p[a.$];return c&&c(a,b,d)};e.editFilter=
function(a){var b=0;if(!a.words.some(function(c,f){var p=c.code();if(p)switch(p.$){case "listStart":b++;break;case "listNext":if(0===b)return a.spliceWordsWithRuns(f,1,[d.derive(c.codeFormatting(),{text:{$:"listStart",marker:p.marker}})]),!0;break;case "listEnd":0===b&&a.spliceWordsWithRuns(f,1,[]),b--}})&&0<b){for(var c=[];0<b;)b--,c.push({text:{$:"listEnd"}});a.spliceWordsWithRuns(a.words.length-1,0,c)}}},"doc.js":function(e,k,g){var c=g("per"),l=g("./characters"),f=g("./split"),a=g("./word");e=
g("./node");var d=g("./runs"),b=g("./range"),p=g("./util"),h=g("./frame"),v=g("./codes"),w=g("./rect"),A=function(a,b,d,c){var f=a.selection.start,h=a.selection.end;return function(p){a._wordOrdinals=[];var v=Array.prototype.splice.apply(a.words,[b,d].concat(c));p(A(a,b,c.length,v));a._nextSelection={start:f,end:h}}},m=function(a){var b=[],d=function(a){b.push(a);d.length=b.length};a(d);return function(a){a(m(function(a){for(;b.length;)b.pop()(a)}))}},q=function(a){if(a.isNewLine())return!0;a=a.code();
return!(!a||!a.block&&!a.eof)},n=e.derive({calculateBounds:function(){var a=this.frame.bounds(),b=this.position;return[b.x+a.l,b.y+a.t,b.x+a.w,b.y+a.h]},load:function(b){var d=this;this.undo=[];this.redo=[];this._wordOrdinals=[];this.words=c(l(b)).per(f(d.codes)).map(function(b){return a(b,d.codes)}).all();this.words.push(a());this.layout()},layout:function(){this.frame=null;try{this.frame=c(this.words).per(h(0,0,this._width,0,this)).first()}catch(a){console.error(a)}if(!this.frame)console.error("A bug somewhere has produced an invalid state - rolling back"),
this.performUndo();else if(this._nextSelection){var b=this._nextSelection;delete this._nextSelection;this.select(b.start,b.end)}},range:function(a,d){return b(this,a,d)},documentRange:function(){return this.range(0,this.frame.length-1)},selectedRange:function(){return this.range(this.selection.start,this.selection.end)},save:function(){return this.documentRange().save()},paragraphRange:function(a,b){var d;d=this.wordContainingOrdinal(a);a=0;if(d&&!q(d.word))for(d=d.index;0<d;d--)if(q(this.words[d-
1])){a=this.wordOrdinal(d);break}d=this.wordContainingOrdinal(b);b=this.frame.length-1;if(d&&!q(d.word))for(d=d.index;d<this.words.length;d++)if(q(this.words[d])){b=this.wordOrdinal(d);break}return this.range(a,b)},insert:function(a,b){this.select(this.selection.end+this.selectedRange().setText(a),null,b)},modifyInsertFormatting:function(a,b){this.nextInsertFormatting[a]=b;this.notifySelectionChanged()},applyInsertFormatting:function(a){var b=this.nextInsertFormatting,d=Object.keys(b);d.length&&a.forEach(function(a){d.forEach(function(d){a[d]=
b[d]})})},wordOrdinal:function(a){if(a<this.words.length){var b=this._wordOrdinals.length;if(b<a+1)for(var d=0<b?this._wordOrdinals[b-1]:0;b<=a;b++)this._wordOrdinals[b]=d,d+=this.words[b].length;return this._wordOrdinals[a]}},wordContainingOrdinal:function(a){var b,d=0;this.words.some(function(c,f){if(a>=d&&a<d+c.length)return b={word:c,ordinal:d,index:f,offset:a-d},!0;d+=c.length});return b},runs:function(a,b){var d=this.wordContainingOrdinal(Math.max(0,b.start)),c=this.wordContainingOrdinal(Math.min(b.end,
this.frame.length-1));if(d.index===c.index)d.word.runs(a,{start:d.offset,end:c.offset});else{d.word.runs(a,{start:d.offset});for(d=d.index+1;d<c.index;d++)this.words[d].runs(a);c.word.runs(a,{end:c.offset})}},spliceWordsWithRuns:function(b,d,h){var p=this,v=c(l(h)).per(f(p.codes)).truthy().map(function(b){return a(b,p.codes)}).all(),e=!1;if("_filtersRunning"in p)p._filtersRunning++;else{for(h=0;h<d;h++)this.words[b+h].code()&&(e=!0);e||(e=v.some(function(a){return!!a.code()}))}this.transaction(function(a){A(p,
b,d,v)(a);if(e){p._filtersRunning=0;try{for(;;){var c=p._filtersRunning;if(!p.editFilters.some(function(a){a(p);return c!==p._filtersRunning}))break}}finally{delete p._filtersRunning}}})},splice:function(a,b,f){if("string"===typeof f){var h=Math.max(0,a-1),h=c({start:h,end:h+1}).per(this.runs,this).first();f=[h?Object.create(h,{text:{value:f}}):{text:f}]}else Array.isArray(f)||(f=[{text:f}]);this.applyInsertFormatting(f);var h=this.wordContainingOrdinal(a),p=this.wordContainingOrdinal(b);a===h.ordinal?
0<h.index&&!q(this.words[h.index-1])?(h.index--,a=this.words[h.index],a=c({}).per(a.runs,a).all()):a=[]:a=c({end:h.offset}).per(h.word.runs,h.word).all();b===p.ordinal?b===this.frame.length-1||q(p.word)?(b=[],p.index--):b=c({}).per(p.word.runs,p.word).all():b=c({start:p.offset}).per(p.word.runs,p.word).all();var v=this.frame.length;this.spliceWordsWithRuns(h.index,p.index-h.index+1,c(a).concat(f).concat(b).per(d.consolidate()).all());return this.frame?this.frame.length-v:0},registerEditFilter:function(a){this.editFilters.push(a)},
width:function(a){if(0===arguments.length)return this._width;this._width=a;this.layout()},children:function(){return[this.frame]},toggleCaret:function(){var a=this.caretVisible;this.selection.start===this.selection.end&&(this.selectionJustChanged?this.selectionJustChanged=!1:this.caretVisible=!this.caretVisible);return this.caretVisible!==a},getCaretCoords:function(a){var b=this.byOrdinal(a);if(b)return b.block&&0<a?(b=this.byOrdinal(a-1),b.newLine?(a=b.bounds(),b=b.parent().parent().bounds(),a=w(b.l,
b.b,1,a.h)):(a=b.bounds(),a=w(a.r,a.t,1,a.h))):(a=b.bounds(),a=a.h?w(a.l,a.t,1,a.h):w(a.l,a.t,a.w,1)),a},byCoordinate:function(a,b){for(var d=this.frame.byCoordinate(a,b).ordinal,c=this.getCaretCoords(d);c.b<=b&&d<this.frame.length-1;)d++,c=this.getCaretCoords(d);for(;c.t>=b&&0<d;)d--,c=this.getCaretCoords(d);return this.byOrdinal(d)},drawSelection:function(a,b){if(this.selection.end===this.selection.start){if(this.selectionJustChanged||b&&this.caretVisible){var d=this.getCaretCoords(this.selection.start);
d&&(a.save(),a.fillStyle="black",d.fill(a),a.restore())}}else a.save(),a.fillStyle=b?"rgba(0, 100, 200, 0.3)":"rgba(160, 160, 160, 0.3)",this.selectedRange().parts(function(b){b.bounds(!0).fill(a)}),a.restore()},notifySelectionChanged:function(a){var b=null,d=this;this.selectionChanged.fire(function(){b||(b=d.selectedRange().getFormatting());return b},a)},select:function(a,b,d){this.frame&&(this.selection.start=Math.max(0,a),this.selection.end=Math.min("number"===typeof b?b:this.selection.start,this.frame.length-
1),this.caretVisible=this.selectionJustChanged=!0,this.nextInsertFormatting={},this.notifySelectionChanged(d))},performUndo:function(a){var b=a?this.undo:this.redo;if(a=(a?this.redo:this.undo).pop())a(function(a){b.push(a)}),this.layout(),this.contentChanged.fire()},canUndo:function(a){return a?!!this.redo.length:!!this.undo.length},transaction:function(a){if(this._currentTransaction)a(this._currentTransaction);else{for(var b=this;50<this.undo.length;)b.undo.shift();this.redo.length=0;var d=!1;this.undo.push(m(function(c){b._currentTransaction=
c;try{a(c)}finally{d=0<c.length,b._currentTransaction=null}}));d&&(b.layout(),b.contentChanged.fire())}},type:"document"});k.exports=function(){var a=Object.create(n);a._width=0;a.selection={start:0,end:0};a.caretVisible=!0;a.customCodes=function(a,b,d){};a.codes=function(b,d){return v(b,d,a.codes)||a.customCodes(b,d,a.codes)};a.selectionChanged=p.event();a.contentChanged=p.event();a.editFilters=[v.editFilter];a.load([]);return a}},"dom.js":function(e,k,g){e.isAttached=function(c){for(;c.parentNode;)c=
c.parentNode;return!!c.body};e.clear=function(c){for(;c.firstChild;)c.removeChild(c.firstChild)};e.setText=function(c,g){e.clear(c);c.appendChild(document.createTextNode(g))};e.handleEvent=function(c,e,f){c.addEventListener(e,function(a){!1===f(a)&&a.preventDefault()})};e.handleMouseEvent=function(c,g,f){e.handleEvent(c,g,function(a){var d=c.getBoundingClientRect();return f(a,a.clientX-d.left,a.clientY-d.top)})};e.effectiveStyle=function(c,e){return document.defaultView.getComputedStyle(c).getPropertyValue(e)}},
"editor.js":function(e,k,g){g("per");var c=g("./doc"),l=g("./dom"),f=g("./rect");Date.now();e.paint=function(a,d,b,c){var h=c.worldToScreen(d.position.x,d.position.y),v=a.width,e=a.height;a=a.getContext("2d");a.save();v=f(0,0,v,e);c=c.scale();a.translate(h.x,h.y);a.scale(c,c);d.draw(a,v);d.isActive&&Modes.currentMode==Modes.text&&d.frame&&(d.drawSelection(a,b),d=d.frame.bounds())&&(a.setLineDash([5]),a.strokeStyle="red",a.strokeRect(0,0,d.w,d.h));a.restore()};e.create=function(a,d,b){a.innerHTML=
'<div class="carotaTextArea" style="overflow: hidden; position: absolute; height: 0;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none; font-size: 4px;"></textarea></div>';d=d||a.querySelector("canvas");var f=a.querySelector(".carotaTextArea"),h=a.querySelector("textarea"),e=c(),g=0,k=null,m=null,q=null,n="",t=null,r=null;e.width(d.clientWidth);e.claimFocus=function(){$(h).focus()};var y=
{66:"bold",73:"italic",85:"underline",83:"strikeout"},x=function(a,b){var d=e.getCaretCoords(a),c;for(m=null!==k?k:d.l;!(0>b?0>=a:a>=e.frame.length-1)&&!(a+=b,c=e.getCaretCoords(a),c.b<=d.t||d.b<=c.t););for(d=c;!((0>b?0>=a:a>=e.frame.length-1)||0<b&&c.l>=m||0>b&&c.l<=m);)if(a+=b,c=e.getCaretCoords(a),c.b<=d.t||d.b<=c.t){a-=b;break}return a},B=function(a,b){for(var d=e.getCaretCoords(a),c;!(0>b?0>=a:a>=e.frame.length-1);)if(a+=b,c=e.getCaretCoords(a),c.b<=d.t||d.b<=c.t){a-=b;break}return a},z=function(a,
d,c){var h=e.selection.start,f=e.selection.end,p=e.frame.length-1,l=!1;m=null;if(!d)g=0;else if(!g)switch(a){case 37:case 38:case 36:case 33:g=-1;break;case 39:case 40:case 35:case 34:g=1}var n=1===g?f:h,u=!1;switch(a){case 37:d||h==f?0<n&&(c?(u=e.wordContainingOrdinal(n),n=u.ordinal===n?0<u.index?e.wordOrdinal(u.index-1):0:u.ordinal):n--):n=h;u=!0;break;case 39:d||h==f?n<p&&(c?(u=e.wordContainingOrdinal(n),n=u.ordinal+u.word.length):n++):n=f;u=!0;break;case 40:n=x(n,1);u=!0;break;case 38:n=x(n,-1);
u=!0;break;case 36:n=B(n,-1);u=!0;break;case 35:n=B(n,1);u=!0;break;case 33:n=0;u=!0;break;case 34:n=p;u=!0;break;case 8:h===f&&0<h&&(e.range(h-1,h).clear(),q=h-1,e.select(q,q),l=!0);break;case 46:h===f&&h<p&&(e.range(h,h+1).clear(),l=!0);break;case 90:c&&(l=!0,e.performUndo());break;case 89:c&&(l=!0,e.performUndo(!0));break;case 65:c&&(l=!0,e.select(0,p));break;case 67:case 88:c&&(t=e.selectedRange().save(),r=e.selectedRange().plainText())}a=y[a];c&&a&&(c=e.selectedRange(),c.setFormatting(a,!0!==
c.getFormatting()[a]),b(),l=!0);if(u){switch(g){case 0:h=f=n;break;case -1:h=n;break;case 1:f=n}h===f?g=0:h>f&&(g=-g,c=f,f=h,h=c);q=n;e.select(h,f);l=!0}k=m;return l};l.handleEvent(h,"keydown",function(a){if(z(a.keyCode,a.shiftKey,a.ctrlKey))return!1});e.setVerticalAlignment=function(a){b()};l.handleEvent(h,"input",function(){var a=h.value;n!=a&&(n="",h.value="",a===r&&(a=t),e.insert(a))});var u=function(){q=null===q?e.selection.end:q;var b=e.byOrdinal(q);q=null;if(b){b=b.bounds();f.style.left=b.l+
"px";f.style.top=b.t+"px";h.focus();var d=Math.max(0,b.t+b.h-(a.scrollTop+a.clientHeight));d&&(a.scrollTop+=d);if(d=Math.max(0,a.scrollTop-b.t))a.scrollTop-=d;if(d=Math.max(0,b.l-(a.scrollLeft+a.clientWidth)))a.scrollLeft+=d;if(b=Math.max(0,a.scrollLeft-b.l))a.scrollLeft-=b}n=e.selectedRange().plainText();h.value=n;h.select();setTimeout(function(){h.focus()},10)};e.selectionChanged(function(a,d){b();!1!==d&&u()});e.dblclickHandler=function(a){(a=a.parent())&&e.select(a.ordinal,a.ordinal+(a.word?a.word.text.length:
a.length))};e.mouseupHandler=function(a){k=null;e.select(a.ordinal,a.ordinal);isActive=!0;u();h.focus()};var C=(new Date).getTime(),D=function(){if(e.isActive){var a=(new Date).getTime();a>C&&(C=a+500,e.toggleCaret()&&b())}setTimeout(D,500)};D();e.sendKey=z;return e}},"frame.js":function(e,k,g){e=g("./node");var c=g("./wrap"),l=g("./rect"),f=e.derive({bounds:function(){if(!this._bounds){var a=0,d=0,b=0,c=0;this.lines.length&&(d=this.lines[0].bounds(),a=d.l,d=d.t,this.lines.forEach(function(a){a=a.bounds();
b=Math.max(b,a.l+a.w);c=Math.max(c,a.t+a.h)}));this._bounds=l(a,d,b-a,this.height||c-d)}return this._bounds},actualWidth:function(){if(!this._actualWidth){var a=0;this.lines.forEach(function(d){"number"===typeof d.actualWidth&&(a=Math.max(a,d.actualWidth))});this._actualWidth=a}return this._actualWidth},children:function(){return this.lines},parent:function(){return this._parent},draw:function(a,d){this.lines.some(function(b){b.draw(a,d)})},type:"frame"});k.exports=function(a,d,b,e,h,g,l,k){var m=
[],q=Object.create(f,{lines:{value:m},_parent:{value:h},ordinal:{value:e}}),n=c(a,d,b,e,q,g,l,k),t=0,r=0;return function(a,b){if(n(function(a){"number"===typeof a?r=a:(t=a.ordinal+a.length-e,m.push(a))},b))return Object.defineProperty(q,"length",{value:t}),Object.defineProperty(q,"height",{value:r}),a(q),!0}}},"html.js":function(e,k,g){var c=g("./runs"),l=g("per");k=function(a,b){return function(d,c){d.nodeName===a&&(c[b]=!0)}};var f=function(a,b,d,c){return function(h,f){var e=h[a]&&h[a][b];e&&(c&&
(e=c(e)),f[d]=e)}};g=function(a,b,d){return f("attributes",a,b,d)};var a=function(a,b,d){return f("style",a,b,d)},d=function(a,b,d){return function(c,h){c.style&&c.style[a]===b&&(h[d]=!0)}},b=[6,7,9,10,12,16,20,30],p={left:!0,center:!0,right:!0,justify:!0},h=function(a){return p[a]?a:"left"},v=function(a){var b=a.split(/\s*,\s*/g);if(0==b.length)return a;a=b[0];return(b=a.match(/^"(.*)"$/))?b[1].trim():(b=a.match(/^'(.*)'$/))?b[1].trim():a},w={H1:30,H2:20,H3:16,H4:14,H5:12},A=[k("B","bold"),k("STRONG",
"bold"),k("I","italic"),k("EM","italic"),k("U","underline"),k("S","strikeout"),k("STRIKE","strikeout"),k("DEL","strikeout"),d("fontWeight","bold","bold"),d("fontStyle","italic","italic"),d("textDecoration","underline","underline"),d("textDecoration","line-through","strikeout"),a("color","color"),a("fontFamily","font",v),a("fontSize","size",function(a){return(a=a.match(/^([\d\.]+)pt$/))?parseFloat(a[1]):10}),a("textAlign","align",h),function(a,b){"SUB"===a.nodeName&&(b.script="sub")},function(a,b){"SUPER"===
a.nodeName&&(b.script="super")},function(a,b){"CODE"===a.nodeName&&(b.font="monospace")},function(a,b){var d=w[a.nodeName];d&&(b.size=d)},g("color","color"),g("face","font",v),g("align","align",h),g("size","size",function(a){return b[a]||10})],m={};"BR P H1 H2 H3 H4 H5".split(" ").forEach(function(a){m[a]=!0});e.parse=function(a,b){function d(a,c){if(3==a.nodeType)g(a.nodeValue,c);else{c=Object.create(c);var h=a.attributes["class"];h&&h.value.split(" ").forEach(function(a){(a=b[a])&&Object.keys(a).forEach(function(b){c[b]=
a[b]})});A.forEach(function(b){b(a,c)});if(a.childNodes)for(h=0;h<a.childNodes.length;h++)d(a.childNodes[h],c);m[a.nodeName]&&(p.submit(Object.create(c,{text:{value:"\n"}})),e=!0)}}var h=a;"string"===typeof h&&(h=document.createElement("div"),h.innerHTML=a);var f=[],e=!0,p=l(c.consolidate()).into(f),g=function(a,b){a=a.replace(/\n+\s*/g," ");var d=a.length;a=a.replace(/^\s+/,"");e?e=!1:d!==a.length&&(a=" "+a);d=a.length;a=a.replace(/\s+$/,"");d!==a.length&&(e=!0,a+=" ");p.submit(Object.create(b,{text:{value:a}}))};
d(h,{});return f}},"line.js":function(e,k,g){var c=g("./positionedword"),l=g("./rect");e=g("./node");g("./runs");var f=e.derive({bounds:function(a){if(a){a=this.first().bounds();var d=this.last().bounds();return l(a.l,this.baseline-this.ascent,d.l+d.w-a.l,this.ascent+this.descent)}return l(this.left,this.baseline-this.ascent,this.width,this.ascent+this.descent)},parent:function(){return this.doc},children:function(){return this.positionedWords},type:"line"});k.exports=function(a,d,b,e,h,g,l,k){var m=
l[0].align(),q=Object.create(f,{doc:{value:a},left:{value:d},width:{value:b},baseline:{value:e},ascent:{value:h},descent:{value:g},ordinal:{value:k},align:{value:m}}),n=0;l.forEach(function(a){n+=a.width});var n=n-l[l.length-1].space.width,t=0,r=0;if(n<b)switch(m){case "right":t=b-n;break;case "center":t=(b-n)/2;break;case "justify":1<l.length&&!l[l.length-1].isNewLine()&&(r=(b-n)/(l.length-1))}Object.defineProperty(q,"positionedWords",{value:l.map(function(a){var b=t;t+=a.width+r;var d=k;k+=a.text.length+
a.space.length;return c(a,q,b,d,a.width+r)})});Object.defineProperty(q,"actualWidth",{value:n});Object.defineProperty(q,"length",{value:k-q.ordinal});return q}},"node.js":function(e,k,g){g("per");g("./runs");var c=g("./rect"),l=g("./util");e.prototype={children:function(){return[]},parent:function(){return null},first:function(){return this.children()[0]},last:function(){return this.children()[this.children().length-1]},next:function(){for(var a=this;;){var d=a.parent();if(!d)return null;var b=d.children();
if(a=b[b.indexOf(a)+1]){for(;;){d=a.first();if(!d)break;a=d}return a}a=d}},previous:function(){var a=this.parent();if(!a)return null;var d=a.children();return(d=d[d.indexOf(this)-1])?d:(a=a.previous())?a.last():null},byOrdinal:function(a){var d=null;return this.children().some(function(b){if(a>=b.ordinal&&a<b.ordinal+b.length&&(d=b.byOrdinal(a)))return!0})?d:this},byCoordinate:function(a,d){var b;this.children().some(function(c){if(c.bounds().contains(a,d)&&(b=c.byCoordinate(a,d)))return!0});if(!b){for(b=
this.last();b;){var c=b.last();if(!c)break;b=c}(c=b.next())&&c.block&&(b=c)}return b},draw:function(a,d){this.children().forEach(function(b){b.draw(a,d)})},parentOfType:function(a){var d=this.parent();return d&&(d.type===a?d:d.parentOfType(a))},bounds:function(){var a=this._left,d=this._top,b=0,f=0;this.children().forEach(function(c){c=c.bounds();a=Math.min(a,c.l);d=Math.min(d,c.t);b=Math.max(b,c.l+c.w);f=Math.max(f,c.t+c.h)});return c(a,d,b-a,f-d)}};e.derive=function(a){return l.derive(e.prototype,
a)};var f=e.derive({children:function(){return this._children},parent:function(){return this._parent},finalize:function(a,d){var b=Number.MAX_VALUE,c=0;this._children.forEach(function(a){b=Math.min(b,a.ordinal);c=Math.max(c,a.ordinal+a.length)});Object.defineProperty(this,"ordinal",{value:b-(a||0)});Object.defineProperty(this,"length",{value:(d||0)+c-b})}});e.generic=function(a,d,b,c){return Object.create(f,{type:{value:a},_children:{value:[]},_parent:{value:d},_left:{value:"number"===typeof b?b:
Number.MAX_VALUE},_top:{value:"number"===typeof c?c:Number.MAX_VALUE}})}},"part.js":function(e,k,g){var c=g("./text"),l={measure:function(a){var d=d.measure("?",a);return{width:d.width+4,ascent:d.width+2,descent:d.width+2}},draw:function(a,d,b,c,f,e){a.fillStyle="silver";a.fillRect(d,b-f,c,f+e);a.strokeRect(d,b-f,c,f+e);a.fillStyle="black";a.fillText("?",d+2,b)}},f={draw:function(a,d,b){"string"===typeof this.run.text?c.draw(a,this.run.text,this.run,d,b,this.width,this.ascent,this.descent):this.code&&
this.code.draw&&(a.save(),this.code.draw(a,d,b,this.width,this.ascent,this.descent,this.run),a.restore())}};k.exports=function(a,d){var b,e,h;"string"===typeof a.text?(e=1===a.text.length&&"\n"===a.text[0],b=c.measure(e?c.nbsp:a.text,a)):(h=d(a.text)||l,b=h.measure?h.measure(a):{width:0,ascent:0,descent:0});b=Object.create(f,{run:{value:a},isNewLine:{value:e},width:{value:e?0:b.width},ascent:{value:b.ascent},descent:{value:b.descent}});h&&Object.defineProperty(b,"code",{value:h});return b}},"positionedword.js":function(e,
k,g){var c=g("./rect"),l=g("./part"),f=g("./text");e=g("./node");g("./word");var a=g("./runs"),d=e.derive({bounds:function(){var a=this.word.bounds(),b=this.word.word.isNewLine()?f.measure(f.enter,this.word.word.run).width:this.width||this.part.width;return c(a.l+this.left,a.t,b,a.h)},parent:function(){return this.word},byOrdinal:function(){return this},byCoordinate:function(a,b){return a<=this.bounds().center().x?this:this.next()},type:"character"}),b=e.derive({draw:function(a){this.word.draw(a,
this.line.left+this.left,this.line.baseline)},bounds:function(){return c(this.line.left+this.left,this.line.baseline-this.line.ascent,this.word.isNewLine()?f.measure(f.enter,this.word.run).width:this.width,this.line.ascent+this.line.descent)},parts:function(a){this.word.text.parts.some(a)||this.word.space.parts.some(a)},realiseCharacters:function(){if(!this._characters){var b=[],c=0,f=this,e=this.ordinal,g=this.parentOfType("document").codes;this.parts(function(m){a.pieceCharacters(function(a){var k=
Object.create(m.run);k.text=a;a=l(k,g);b.push(Object.create(d,{left:{value:c},part:{value:a},word:{value:f},ordinal:{value:e},length:{value:1}}));c+=a.width;e++},m.run.text)});var m=b[b.length-1];m&&(Object.defineProperty(m,"width",{value:this.width-m.left}),(this.word.isNewLine()||this.word.code()&&this.word.code().eof)&&Object.defineProperty(m,"newLine",{value:!0}));this._characters=b}},children:function(){this.realiseCharacters();return this._characters},parent:function(){return this.line},type:"word"});
k.exports=function(a,d,c,f,e){return Object.create(b,{word:{value:a},line:{value:d},left:{value:c},width:{value:e},ordinal:{value:f},length:{value:a.text.length+a.space.length}})}},"range.js":function(e,k,g){function c(a,d,b){this.doc=a;this.start=d;this.end=b;d>b&&(this.start=b,this.end=d)}var l=g("per"),f=g("./runs");c.prototype.parts=function(a,d){d=d||this.doc.children();var b=this;d.some(function(d){if(d.ordinal+d.length<=b.start)return!1;if(d.ordinal>=b.end)return!0;d.ordinal>=b.start&&d.ordinal+
d.length<=b.end?a(d):b.parts(a,d.children())})};c.prototype.clear=function(){return this.setText([])};c.prototype.setText=function(a){return this.doc.splice(this.start,this.end,a)};c.prototype.runs=function(a){this.doc.runs(a,this)};c.prototype.plainText=function(){return l(this.runs,this).map(f.getPlainText).all().join("")};c.prototype.save=function(){return l(this.runs,this).per(f.consolidate()).all()};c.prototype.getFormatting=function(){if(this.start===this.end){var a=this.start;0<a&&a--;this.start=
a;this.end=a+1}return l(this.runs,this).reduce(f.merge).last()||f.defaultFormatting};c.prototype.setFormatting=function(a,d){var b=this;"align"===a&&(b=b.doc.paragraphRange(b.start,b.end));if(b.start===b.end)b.doc.modifyInsertFormatting(a,d);else{var c=b.save(),e={};e[a]=d;f.format(c,e);b.setText(c)}};k.exports=function(a,d,b){return new c(a,d,b)}},"rect.js":function(e,k,g){var c={contains:function(c,a){return c>=this.l&&c<this.l+this.w&&a>=this.t&&a<this.t+this.h},stroke:function(c){c.strokeRect(this.l,
this.t,this.w,this.h)},fill:function(c){c.fillRect(this.l,this.t,this.w,this.h)},offset:function(c,a){return l(this.l+c,this.t+a,this.w,this.h)},equals:function(c){return this.l===c.l&&this.t===c.t&&this.w===c.w&&this.h===c.h},center:function(){return{x:this.l+this.w/2,y:this.t+this.h/2}}},l=k.exports=function(e,a,d,b){return Object.create(c,{l:{value:e},t:{value:a},w:{value:d},h:{value:b},r:{value:e+d},b:{value:a+b}})}},"runs.js":function(e,k,g){e.formattingKeys="bold italic underline strikeout color font size align script".split(" ");
e.defaultFormatting={size:30,font:"sans-serif",color:["#000000",255],bold:!1,italic:!1,underline:!1,strikeout:!1,align:"left",script:"normal"};e.sameFormatting=function(c,g){return e.formattingKeys.every(function(e){return c[e]===g[e]})};e.clone=function(c){var g={text:c.text};e.formattingKeys.forEach(function(f){var a=c[f];a&&a!=e.defaultFormatting[f]&&(g[f]=a)});return g};e.multipleValues={};e.merge=function(c,g){if(1===arguments.length)return Array.isArray(c)?c.reduce(e.merge):c;if(2<arguments.length)return e.merge(Array.prototype.slice.call(arguments,
0));var f={};e.formattingKeys.forEach(function(a){if(a in c||a in g)f[a]=c[a]===g[a]?c[a]:e.multipleValues});return f};e.format=function(c,g){Array.isArray(c)?c.forEach(function(c){e.format(c,g)}):Object.keys(g).forEach(function(f){g[f]!==e.multipleValues&&(c[f]=g[f])})};e.consolidate=function(){var c;return function(g,f){c&&e.sameFormatting(c,f)&&"string"==typeof c.text&&"string"==typeof f.text?c.text+=f.text:(c=e.clone(f),g(c))}};e.getPlainText=function(c){if("string"===typeof c.text)return c.text;
if(Array.isArray(c.text)){var g=[];c.text.forEach(function(c){g.push(e.getPiecePlainText(c))});return g.join("")}return"_"};e.getPieceLength=function(c){return c.length||1};e.getPiecePlainText=function(c){return c.length?c:"_"};e.getTextLength=function(c){if("string"===typeof c)return c.length;if(Array.isArray(c)){var g=0;c.forEach(function(c){g+=e.getPieceLength(c)});return g}return 1};e.getSubText=function(c,g,f,a){if(0!==a)if("string"===typeof g)c(g.substr(f,a));else if(Array.isArray(g)){var d=
0;g.some(function(b){if(0>=a)return!0;var g=e.getPieceLength(b);d+g>f&&(1===g?(c(b),--a):(b=b.substr(Math.max(0,f-d),a),c(b),a-=b.length));d+=g})}else c(g)};e.getTextChar=function(c,g){var f;e.getSubText(function(a){f=a},c,g,1);return f};e.pieceCharacters=function(c,e){if("string"===typeof e)for(var f=0;f<e.length;f++)c(e[f]);else c(e)}},"split.js":function(e,k,g){k.exports=function(c){var e=null,f=null,a=!0;return function(d,b){var g;if(null===b["char"])g=!0;else if(a&&(g=!0,a=!1),"string"===typeof b["char"])switch(b["char"]){case " ":f||
(f=b);break;case "\n":a=g=!0;break;default:f&&(g=!0)}else{var h=c(b["char"]);if(h.block||h.eof)a=g=!0}if(g){if(e&&!e.equals(b)){if(!1===d({text:e,spaces:f||b,end:b}))return!1;f=null}null===b["char"]&&d(null);e=b}}}},"text.js":function(e,k,g){var c=g("./runs"),l=e.getFontString=function(a){var b=a&&a.size||c.defaultFormatting.size;if(a)switch(a.script){case "super":case "sub":b*=.8}return(a&&a.italic?"italic ":"")+(a&&a.bold?"bold ":"")+" "+b+"pt "+(a&&a.font||c.defaultFormatting.font)};e.applyRunStyle=
function(a,b){a.fillStyle=b&&b.color&&b.color[0]||c.defaultFormatting.color[0];a.font=l(b)};e.prepareContext=function(a){a.textAlign="left";a.textBaseline="alphabetic"};e.getRunStyle=function(a){var b=["font: ",l(a),"; color: ",a&&a.color&&a.color[0]||c.defaultFormatting.color[0]];if(a)switch(a.script){case "super":b.push("; vertical-align: super");break;case "sub":b.push("; vertical-align: sub")}return b.join("")};var f=e.nbsp=String.fromCharCode(160);e.enter=f;var a=e.measureText=function(a,b){var c,
e,g;c=document.createElement("span");e=document.createElement("div");g=document.createElement("div");e.style.display="inline-block";e.style.width="1px";e.style.height="0";g.style.visibility="hidden";g.style.position="absolute";g.style.top="0";g.style.left="0";g.style.width="500px";g.style.height="200px";g.appendChild(c);g.appendChild(e);document.body.appendChild(g);try{c.setAttribute("style",b);c.innerHTML="";c.appendChild(document.createTextNode(a.replace(/\s/g,f)));var l={};e.style.verticalAlign=
"baseline";l.ascent=e.offsetTop-c.offsetTop;e.style.verticalAlign="bottom";l.height=e.offsetTop-c.offsetTop;l.descent=l.height-l.ascent;l.width=c.offsetWidth}finally{g.parentNode.removeChild(g)}return l};k=e.createCachedMeasureText=function(){var d={};return function(b,c){var e=c+"<>!&%"+b,f=d[e];f||(d[e]=f=a(b,c));return f}};e.cachedMeasureText=k();e.measure=function(a,b){return e.cachedMeasureText(a,e.getRunStyle(b))};e.draw=function(a,b,c,f,g,l,k,m){e.prepareContext(a);e.applyRunStyle(a,c);switch(c.script){case "super":g-=
1/3*k;break;case "sub":g+=m/2}a.fillText("\n"===b?e.enter:b,f,g);c.underline&&a.fillRect(f,1+g,l,1);c.strikeout&&a.fillRect(f,1+g-k/2,l,1)}},"util.js":function(e,k,g){e.event=function(){var c=[],e=function(e){c.push(e)};e.fire=function(){var e=Array.prototype.slice.call(arguments,0);c.forEach(function(a){a.apply(null,e)})};return e};e.derive=function(c,e){var f={};Object.keys(e).forEach(function(a){f[a]={value:e[a]}});return Object.create(c,f)}},"word.js":function(e,k,g){var c=g("per"),l=g("./part"),
f=g("./runs"),a={isNewLine:function(){return 1==this.text.parts.length&&this.text.parts[0].isNewLine},code:function(){return 1==this.text.parts.length&&this.text.parts[0].code},codeFormatting:function(){return 1==this.text.parts.length&&this.text.parts[0].run},draw:function(a,d,e){c(this.text.parts).concat(this.space.parts).forEach(function(c){c.draw(a,d,e);d+=c.width})},plainText:function(){return this.text.plainText+this.space.plainText},align:function(){var a=this.text.parts[0];return a?a.run.align:
"left"},runs:function(a,d){var c=d&&d.start||0,e=d&&d.end;"number"!==typeof e&&(e=Number.MAX_VALUE);[this.text,this.space].forEach(function(d){d.parts.some(function(d){if(c>=e||0>=e)return!0;var f=d.run;d=f.text;if("string"===typeof d){if(0>=c&&e>=d.length)a(f);else if(c<d.length){var f=Object.create(f),g=Math.max(0,c);f.text=d.substr(g,Math.min(d.length,e-g));a(f)}c-=d.length;e-=d.length}else 0>=c&&1<=e&&a(f),c--,e--})})}},d=function(a,d){var e={parts:c(a).map(function(a){return l(a,d)}).all(),ascent:0,
descent:0,width:0,length:0,plainText:""};e.parts.forEach(function(a){e.ascent=Math.max(e.ascent,a.ascent);e.descent=Math.max(e.descent,a.descent);e.width+=a.width;e.length+=f.getPieceLength(a.run.text);e.plainText+=f.getPiecePlainText(a.run.text)});return e};k.exports=function(b,c){var e,f;b?(e=b.text.cut(b.spaces),f=b.spaces.cut(b.end)):(e=[{text:"\n"}],f=[]);e=d(e,c);f=d(f,c);e=Object.create(a,{text:{value:e},space:{value:f},ascent:{value:Math.max(e.ascent,f.ascent)},descent:{value:Math.max(e.descent,
f.descent)},width:{value:e.width+f.width,configurable:!0},length:{value:e.length+f.length}});b||Object.defineProperty(e,"eof",{value:!0});return e}},"wrap.js":function(e,k,g){var c=g("./line");k.exports=function(e,f,a,d,b,g,h,k){var w=[],A=0,m=h||0,q=k||0,n,t=0,r=f,y=function(a,b){w.push(a);A+=a.width;m=Math.max(m,a.ascent);q=Math.max(q,a.descent);a.isNewLine()&&(x(b),t=a.ascent+a.descent)},x=function(f){if(!n&&0!==w.length){var g=c(b,e,a,r+m,m,q,w,d);d+=g.length;n=f(g);r+=m+q;A=m=q=w.length=0}},
B=null;return function(c,h){if(B){t=0;var k=B(h);k&&(B=null,d+=k.length,r+=k.bounds().h,Object.defineProperty(k,"block",{value:!0}),c(k))}else(k=h.code())&&k.block?(w.length?x(c):r+=t,B=k.block(e,r,a,d,b,h.codeFormatting()),t=0):k&&k.eof||h.eof?((!k||g&&g(k))&&y(h,c),w.length?(x(c),c(r-f)):c(r+t-f),n=!0):(t=0,w.length&&A+h.text.width>a&&x(c),y(h,c));return n}}}}},per:{":mainpath:":"per.js","per.js":function(e,k,g){(function(c){function e(a,b){return"function"!==typeof a?Array.isArray(a)?function(b){return a.some(b)}:
function(b){return b(a)}:b?function(c,d){a.call(b,c,d)}:a}function f(a,b){this.forEach=e(a,b)}function a(a,b){a(b)}function d(b,c){return 0===arguments.length?new f(a):b&&b instanceof f?b:new f(b,c)}function b(a){return"string"===typeof a?new Function("x","return "+a):a}function g(a,b){var c=a[b];return"function"===typeof c?c:function(c){a[b]=c}}function h(){}function k(a){return!!a}function w(a,b){return Math.min(a,b)}function A(a,b){return Math.max(a,b)}function m(a,b){return a+b}function q(a,b){return!(!a||
!b)}function n(a,b){return!(!a&&!b)}function t(a){return!a}f.prototype.per=function(a,b){var c=this.forEach,f=e(a&&a.forEach||a,b);return d(function(a,b){return c(function(b){return f(a,b)},b)})};f.prototype.map=function(a){a=b(a);return this.per(function(b,c){return b(a(c))})};f.prototype.filter=function(a){a=b(a);return this.per(function(b,c){if(a(c))return b(c)})};f.prototype.concat=function(a,b){a=a instanceof f?a.forEach:e(a,b);var c=this.forEach;return d(function(b,d){c(b,d);a(b,d)})};f.prototype.skip=
function(a){return this.per(function(b,c){return 0<a?(a--,!1):b(c)})};f.prototype.take=function(a){return this.per(function(b,c){if(0>=a)return!0;a--;return b(c)})};f.prototype.listen=function(a){return this.per(function(b,c){return a(c)?!0:b(c)})};f.prototype.flatten=function(){return this.per(function(a,b){return Array.isArray(b)?b.some(function(b){return a(b)}):a(b)})};f.prototype.reduce=function(a,b){var c=b,d=2==arguments.length;return this.per(function(b,e){c=d?a(c,e):e;b(c);d=!0})};f.prototype.multicast=
function(a){1!==arguments.length&&(a=Array.prototype.slice.call(arguments,0));a=a.map(function(a){return"function"===typeof a?a:a instanceof f?a.forEach:h});return this.listen(function(b){var c=!0;a.forEach(function(a){a(h,b)||(c=!1)});return c})};f.prototype.into=function(a,b){if(!Array.isArray(a))throw Error("into expects an array");b="number"!=typeof b?Number.MAX_VALUE:b;return this.listen(function(c){if(0>=b)return!0;a.push(c);b--})};f.prototype.monitor=function(a){var b=0,c=g(a,"count"),d=g(a,
"first"),e=g(a,"last"),f=a.limit;"number"!=typeof f&&(f=Number.MAX_VALUE);return 1>f?this:this.listen(function(a){0===b&&d(a);b++;c(b);e(a);if(b>=f)return!0})};f.prototype.submit=function(a){return this.forEach(h,a)};f.prototype.all=function(){var a=[];this.into(a).submit();return a};f.prototype.first=function(){var a={limit:1};this.monitor(a).submit();return 0<a.count?a.first:void 0};f.prototype.last=function(){var a={};this.monitor(a).submit();return 0<a.count?a.last:void 0};f.prototype.truthy=
function(){return this.filter(k)};f.prototype.min=function(){return this.reduce(w,Number.MAX_VALUE)};f.prototype.max=function(){return this.reduce(A,Number.MIN_VALUE)};f.prototype.sum=function(){return this.reduce(m,0)};f.prototype.and=function(){return this.reduce(q,!0)};f.prototype.or=function(){return this.reduce(n,!1)};f.prototype.not=function(){return this.map(t)};d.pulse=function(a){var b=0;return d(function(c){function d(){!0!==c(b++)&&setTimeout(d,a)}d()})};c(d)})(function(c){"undefined"===
typeof e?this.per=c:k.exports=c})}}})("carota/src/carota");
